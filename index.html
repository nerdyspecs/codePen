<div class="text-center">
    <h1 class="display-4">CodePen</h1>
</div>

<div class="container mt-3">
    <h2>Product List</h2>
    <table class="table table-bordered table-striped">
        <thead class="thead-dark">
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Weight</th>
                <th>Price</th>
                <th>Select</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>1</td>
                <td>Item 1</td>
                <td>200</td>
                <td>10</td>
                <td><input type="checkbox" name="selectedProductIds" value="1" data-name="Item 1" data-weight="200" data-price="10" /></td>
            </tr>
            <tr>
                <td>2</td>
                <td>Item 2</td>
                <td>20</td>
                <td>100</td>
                <td><input type="checkbox" name="selectedProductIds" value="2" data-name="Item 2" data-weight="20" data-price="100" /></td>
            </tr>
            <tr>
                <td>3</td>
                <td>Item 3</td>
                <td>300</td>
                <td>30</td>
                <td><input type="checkbox" name="selectedProductIds" value="3" data-name="Item 3" data-weight="300" data-price="30" /></td>
            </tr>
            <tr>
                <td>4</td>
                <td>Item 4</td>
                <td>500</td>
                <td>20</td>
                <td><input type="checkbox" name="selectedProductIds" value="4" data-name="Item 4" data-weight="500" data-price="20" /></td>
            </tr>
            <tr>
                <td>5</td>
                <td>Item 5</td>
                <td>250</td>
                <td>30</td>
                <td><input type="checkbox" name="selectedProductIds" value="5" data-name="Item 5" data-weight="250" data-price="30" /></td>
            </tr>
            <tr>
                <td>6</td>
                <td>Item 6</td>
                <td>10</td>
                <td>40</td>
                <td><input type="checkbox" name="selectedProductIds" value="6" data-name="Item 6" data-weight="10" data-price="40" /></td>
            </tr>
            <tr>
                <td>7</td>
                <td>Item 7</td>
                <td>10</td>
                <td>200</td>
                <td><input type="checkbox" name="selectedProductIds" value="7" data-name="Item 7" data-weight="10" data-price="200" /></td>
            </tr>
            <tr>
                <td>8</td>
                <td>Item 8</td>
                <td>500</td>
                <td>120</td>
                <td><input type="checkbox" name="selectedProductIds" value="8" data-name="Item 8" data-weight="500" data-price="120" /></td>
            </tr>
            <tr>
                <td>9</td>
                <td>Item 9</td>
                <td>790</td>
                <td>130</td>
                <td><input type="checkbox" name="selectedProductIds" value="9" data-name="Item 9" data-weight="790" data-price="130" /></td>
            </tr>
            <tr>
                <td>10</td>
                <td>Item 10</td>
                <td>100</td>
                <td>20</td>
                <td><input type="checkbox" name="selectedProductIds" value="10" data-name="Item 10" data-weight="100" data-price="20" /></td>
            </tr>
            <tr>
                <td>11</td>
                <td>Item 11</td>
                <td>340</td>
                <td>10</td>
                <td><input type="checkbox" name="selectedProductIds" value="11" data-name="Item 11" data-weight="340" data-price="10" /></td>
            </tr>
            <tr>
                <td>12</td>
                <td>Item 12</td>
                <td>800</td>
                <td>4</td>
                <td><input type="checkbox" name="selectedProductIds" value="12" data-name="Item 12" data-weight="800" data-price="4" /></td>
            </tr>
            <tr>
                <td>13</td>
                <td>Item 13</td>
                <td>200</td>
                <td>5</td>
                <td><input type="checkbox" name="selectedProductIds" value="13" data-name="Item 13" data-weight="200" data-price="5" /></td>
            </tr>
            <tr>
                <td>14</td>
                <td>Item 14</td>
                <td>20</td>
                <td>240</td>
                <td><input type="checkbox" name="selectedProductIds" value="14" data-name="Item 14" data-weight="20" data-price="240" /></td>
            </tr>
            <tr>
                <td>15</td>
                <td>Item 15</td>
                <td>700</td>
                <td>123</td>
                <td><input type="checkbox" name="selectedProductIds" value="15" data-name="Item 15" data-weight="700" data-price="123" /></td>
            </tr>
            <tr>
                <td>16</td>
                <td>Item 16</td>
                <td>10</td>
                <td>245</td>
                <td><input type="checkbox" name="selectedProductIds" value="16" data-name="Item 16" data-weight="10" data-price="245" /></td>
            </tr>
            <tr>
                <td>17</td>
                <td>Item 17</td>
                <td>20</td>
                <td>230</td>
                <td><input type="checkbox" name="selectedProductIds" value="17" data-name="Item 17" data-weight="20" data-price="230" /></td>
            </tr>
            <tr>
                <td>18</td>
                <td>Item 18</td>
                <td>200</td>
                <td>110</td>
                <td><input type="checkbox" name="selectedProductIds" value="18" data-name="Item 18" data-weight="200" data-price="110" /></td>
            </tr>
            <tr>
                <td>19</td>
                <td>Item 19</td>
                <td>200</td>
                <td>45</td>
                <td><input type="checkbox" name="selectedProductIds" value="19" data-name="Item 19" data-weight="200" data-price="45" /></td>
            </tr>
            <tr>
                <td>20</td>
                <td>Item 20</td>
                <td>20</td>
                <td>67</td>
                <td><input type="checkbox" name="selectedProductIds" value="20" data-name="Item 20" data-weight="20" data-price="67" /></td>
            </tr>
            <tr>
                <td>21</td>
                <td>Item 21</td>
                <td>300</td>
                <td>88</td>
                <td><input type="checkbox" name="selectedProductIds" value="21" data-name="Item 21" data-weight="300" data-price="88" /></td>
            </tr>
            <tr>
                <td>22</td>
                <td>Item 22</td>
                <td>500</td>
                <td>10</td>
                <td><input type="checkbox" name="selectedProductIds" value="22" data-name="Item 22" data-weight="500" data-price="10" /></td>
            </tr>
            <tr>
                <td>23</td>
                <td>Item 23</td>
                <td>250</td>
                <td>17</td>
                <td><input type="checkbox" name="selectedProductIds" value="23" data-name="Item 23" data-weight="250" data-price="17" /></td>
            </tr>
            <tr>
                <td>24</td>
                <td>Item 24</td>
                <td>10</td>
                <td>19</td>
                <td><input type="checkbox" name="selectedProductIds" value="24" data-name="Item 24" data-weight="10" data-price="19" /></td>
            </tr>
            <tr>
                <td>25</td>
                <td>Item 25</td>
                <td>10</td>
                <td>89</td>
                <td><input type="checkbox" name="selectedProductIds" value="25" data-name="Item 25" data-weight="10" data-price="89" /></td>
            </tr>
            <tr>
                <td>26</td>
                <td>Item 26</td>
                <td>500</td>
                <td>45</td>
                <td><input type="checkbox" name="selectedProductIds" value="26" data-name="Item 26" data-weight="500" data-price="45" /></td>
            </tr>
            <tr>
                <td>27</td>
                <td>Item 27</td>
                <td>790</td>
                <td>99</td>
                <td><input type="checkbox" name="selectedProductIds" value="27" data-name="Item 27" data-weight="790" data-price="99" /></td>
            </tr>
            <tr>
                <td>28</td>
                <td>Item 28</td>
                <td>100</td>
                <td>125</td>
                <td><input type="checkbox" name="selectedProductIds" value="28" data-name="Item 28" data-weight="100" data-price="125" /></td>
            </tr>
            <tr>
                <td>29</td>
                <td>Item 29</td>
                <td>340</td>
                <td>198</td>
                <td><input type="checkbox" name="selectedProductIds" value="29" data-name="Item 29" data-weight="340" data-price="198" /></td>
            </tr>
            <tr>
                <td>30</td>
                <td>Item 30</td>
                <td>800</td>
                <td>220</td>
                <td><input type="checkbox" name="selectedProductIds" value="30" data-name="Item 30" data-weight="800" data-price="220" /></td>
            </tr>
            <tr>
                <td>31</td>
                <td>Item 31</td>
                <td>200</td>
                <td>249</td>
                <td><input type="checkbox" name="selectedProductIds" value="31" data-name="Item 31" data-weight="200" data-price="249" /></td>
            </tr>
            <tr>
                <td>32</td>
                <td>Item 32</td>
                <td>20</td>
                <td>230</td>
                <td><input type="checkbox" name="selectedProductIds" value="32" data-name="Item 32" data-weight="20" data-price="230" /></td>
            </tr>
            <tr>
                <td>33</td>
                <td>Item 33</td>
                <td>700</td>
                <td>190</td>
                <td><input type="checkbox" name="selectedProductIds" value="33" data-name="Item 33" data-weight="700" data-price="190" /></td>
            </tr>
            <tr>
                <td>34</td>
                <td>Item 34</td>
                <td>10</td>
                <td>45</td>
                <td><input type="checkbox" name="selectedProductIds" value="34" data-name="Item 34" data-weight="10" data-price="45" /></td>
            </tr>
            <tr>
                <td>35</td>
                <td>Item 35</td>
                <td>20</td>
                <td>12</td>
                <td><input type="checkbox" name="selectedProductIds" value="35" data-name="Item 35" data-weight="20" data-price="12" /></td>
            </tr>
            <tr>
                <td>36</td>
                <td>Item 36</td>
                <td>200</td>
                <td>5</td>
                <td><input type="checkbox" name="selectedProductIds" value="36" data-name="Item 36" data-weight="200" data-price="5" /></td>
            </tr>
            <tr>
                <td>37</td>
                <td>Item 37</td>
                <td>200</td>
                <td>2</td>
                <td><input type="checkbox" name="selectedProductIds" value="37" data-name="Item 37" data-weight="200" data-price="2" /></td>
            </tr>
            <tr>
                <td>38</td>
                <td>Item 38</td>
                <td>20</td>
                <td>90</td>
                <td><input type="checkbox" name="selectedProductIds" value="38" data-name="Item 38" data-weight="20" data-price="90" /></td>
            </tr>
            <tr>
                <td>39</td>
                <td>Item 39</td>
                <td>300</td>
                <td>12</td>
                <td><input type="checkbox" name="selectedProductIds" value="39" data-name="Item 39" data-weight="300" data-price="12" /></td>
            </tr>
            <tr>
                <td>40</td>
                <td>Item 40</td>
                <td>500</td>
                <td>167</td>
                <td><input type="checkbox" name="selectedProductIds" value="40" data-name="Item 40" data-weight="500" data-price="167" /></td>
            </tr>
            <tr>
                <td>41</td>
                <td>Item 41</td>
                <td>250</td>
                <td>12</td>
                <td><input type="checkbox" name="selectedProductIds" value="41" data-name="Item 41" data-weight="250" data-price="12" /></td>
            </tr>
            <tr>
                <td>42</td>
                <td>Item 42</td>
                <td>10</td>
                <td>8</td>
                <td><input type="checkbox" name="selectedProductIds" value="42" data-name="Item 42" data-weight="10" data-price="8" /></td>
            </tr>
            <tr>
                <td>43</td>
                <td>Item 43</td>
                <td>10</td>
                <td>2</td>
                <td><input type="checkbox" name="selectedProductIds" value="43" data-name="Item 43" data-weight="10" data-price="2" /></td>
            </tr>
            <tr>
                <td>44</td>
                <td>Item 44</td>
                <td>500</td>
                <td>9</td>
                <td><input type="checkbox" name="selectedProductIds" value="44" data-name="Item 44" data-weight="500" data-price="9" /></td>
            </tr>
            <tr>
                <td>45</td>
                <td>Item 45</td>
                <td>790</td>
                <td>210</td>
                <td><input type="checkbox" name="selectedProductIds" value="45" data-name="Item 45" data-weight="790" data-price="210" /></td>
            </tr>
            <tr>
                <td>46</td>
                <td>Item 46</td>
                <td>100</td>
                <td>167</td>
                <td><input type="checkbox" name="selectedProductIds" value="46" data-name="Item 46" data-weight="100" data-price="167" /></td>
            </tr>
            <tr>
                <td>47</td>
                <td>Item 47</td>
                <td>340</td>
                <td>23</td>
                <td><input type="checkbox" name="selectedProductIds" value="47" data-name="Item 47" data-weight="340" data-price="23" /></td>
            </tr>
            <tr>
                <td>48</td>
                <td>Item 48</td>
                <td>800</td>
                <td>190</td>
                <td><input type="checkbox" name="selectedProductIds" value="48" data-name="Item 48" data-weight="800" data-price="190" /></td>
            </tr>
            <tr>
                <td>49</td>
                <td>Item 49</td>
                <td>200</td>
                <td>199</td>
                <td><input type="checkbox" name="selectedProductIds" value="49" data-name="Item 49" data-weight="200" data-price="199" /></td>
            </tr>
            <tr>
                <td>50</td>
                <td>Item 50</td>
                <td>20</td>
                <td>12</td>
                <td><input type="checkbox" name="selectedProductIds" value="50" data-name="Item 50" data-weight="20" data-price="12" /></td>
            </tr>
        </tbody>

    </table>
        <button id="submitOrder" type="submit" name="action" value="SubmitOrder" class="btn btn-primary">Submit Order</button>
</div>
<div id="result" class="mt-3"></div>


<!-- Bootstrap JS (jQuery and Popper.js included) -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<script>
    $(document).ready(function() {
        function calculateCourierCharges(total_weight) {
            var courierCharge = 0;

            if (total_weight >= 0 && total_weight <= 200) {
                courierCharge = 5;
            } else if (total_weight > 200 && total_weight <= 500) {
                courierCharge = 10;
            } else if (total_weight > 500 && total_weight <= 1000) {
                courierCharge = 15;
            } else if (total_weight > 1000 && total_weight <= 5000) {
                courierCharge = 20;
            }

            return courierCharge;
        }

        $('#submitOrder').click(function() {

            var selectedProducts = [];
            $('input[name="selectedProductIds"]:checked').each(function() {
                // get information from checkbox
                var weight = parseInt($(this).data('weight'));
                var price = parseInt($(this).data('price')); 
                var name = $(this).data('name'); 
                
                // create product variable, to store weight, price and name
                var product = {
                    name: name,
                    price: price,
                    weight: weight
                };

                // push into array
                selectedProducts.push(product)
            });

            // edge case if none were selected
            if (selectedProducts.length === 0) {
                $('#result').html('<div class="alert alert-warning">Please select at least one product.</div>');
                return;
            }

            // Package split
            var packages = [];
            selectedProducts.forEach(function (product) {
                // select package with the lowest total weight, and add price to it. if it exceeds 250, move to the next. if it reaches the end, create new

                // creating the first package
                if (packages.length == 0) {
                    console.log("first package created")
                    var package = {
                        items : [],
                        total_price : 0,
                        total_weight : 0
                    }
                    package.items.push(product);
                    package.total_price += product.price;
                    package.total_weight += product.weight;
                    packages.push(package);
                } else {
                    //sort packages ascending from total weight, making sure the lowest weight is always at the lowest index
                    packages.sort(function (a, b) { return a.total_weight - b.total_weight })

                    // using packages_length to keep track of the end of the loop
                    var packages_length 
                    packages_length = packages.length


                    for (var i = 0; i <= packages.length; i++) {
                        // checking from the lightest total weight, see if the total price exceeds 250
                        // if it doesn't add that into the package. if it does, check the next one
                        package = packages[i]
                        if ((package.total_price + product.price) <= 250) {
                            console.log("added "+product.name+" in package " + i)
                            package.items.push(product);
                            package.total_price += product.price;
                            package.total_weight += product.weight;
                            return;
                        }

                        // if the loop reaches the end, and it still can't find one that the price doesn't exceed 250, create new package
                        if (i == packages_length-1){
                            var package = {
                                items: [],
                                total_price: 0,
                                total_weight: 0
                            }
                            package.items.push(product);
                            package.total_price += product.price;
                            package.total_weight += product.weight;
                            packages.push(package);
                            return;
                        }
                    }
                }
            });

            // show result
            var resultHtml = 'Your order has been split into ' + packages.length + ' packages:<br/><ul>';
            packages.forEach(function (package, index) {

                resultHtml += '<li>Package ' + (index + 1) + '</br> ';
                resultHtml += 'Items - '
                package.items.forEach(function (product) {
                    resultHtml += product.name +', ';
                });
                resultHtml += '<br/> Total Weight   - ' + package.total_weight + 'g'
                resultHtml += '<br/> Total Price   - ' + package.total_price + '$'
                resultHtml += '<br/> Total Courier Price   - ' + calculateCourierCharges(package.total_weight) +'$ <br/><br />'

            });

            $('#result').html(resultHtml);            
        });
    });
</script>
